# 四. I/O

这章的内容比较偏向于硬件底层的驱动部分，由操作系统去控制这些I/O设备。重点在于I/O软件，即驱动程序。

## 直接存储器存取（DMA）

在没有DMA时，操作系统工作时，需要从磁盘中提取数据，此后CPU会对控制器进行操作，控制器从磁盘中串行的读取数据，存储到控制器的缓冲区中，然后再从缓冲区中调用数据到内存中。

当有DMA时，首先CPU会对DMA进行编程，告诉DMA将数据运送到哪个地方。然后DMA控制器通过总线发起一个读请求到磁盘控制器。磁盘控制器直接会将已经读取的内容写到内存中，通过另一个标准总线周期。写操作完成时，磁盘控制器会发送一个应答信号到DMA中，DMA会检查内存中是否还需要写入数据，如果需要则重复上面的步骤。

区别在于一个需要cpu去控制磁盘，另一个只需要DMA去控制，减轻了cpu的运行负担。



## 中断

中断信号导致CPU停止做当前的事情并且开始做其他事情。

### 精确中断和不精确中断

精确中断的几个特征：

​    · PC（程序计数器）保存在一个确定的地方 

​    · PC 所指向指令之前的所有指令已经执行完毕

​    · PC所指向指令之后的所有指令未执行

​    · PC所指向的指令的状态是可知的



I/O实现的三种方式：程序控制，中断驱动和DMA控制

程序控制：即使用高层软件程序来控制I/O,这种控制简单方便，易于实现，但占用CPU时间太长，I/O结束之前都需占用CPU，导致CPU效率低下。

中断驱动：当操作系统准备接受数据时，CPU会被中断，产生调度。然后回到中断前。当数据均已传输完毕，I/O再次产生中断，CPU再次执行操作。数据到来时执行一次中断，数据传输结束时再次产生一次。缺点是每次接受一个字符都要产生一次中断。

DMA控制：CPU只需要对DMA做一次编程，就能让DMA持续的接受数据并传输给内存。

## I/O的组织结构

中断服务程序

设备驱动程序

与设备无关的I/O软件

I/O库及假脱机程序

## 时钟

用于跟踪实际时间，限制进程运行多长时间，处理监视定时器，以及进行计账。

## 瘦客户机

显示器 + 服务器

所有应用程序均安装在中心服务器中，显示器中只安装有闪存，可以短暂存储数据。类似于谷歌云游戏平台Stadia，其限制只有网速限制。

其基本思想是：从客户机中剥离一切智能和软件，只是将其用作一台显示器，使所有的计算都在服务器端完成。客户机和服务器间的协议只是去指导显示器如何去更新显示结果。