# 三. 文件系统

## 综述

  文件是对一系列进程创建的信息的整合。文件的概念在操作系统中的地位等同与进程和地址空间。理解这三个概念是非常重要的。

## 文件和目录

  **文件**：

  1.命名。各个系统不同，对文件的命名也不同。windows中文件按照*文件名.文件扩展名*构成.当然文件扩展名是比较重要的，比如.c文件，如果不加后缀，则c编译器无法进行编译，如.txt.文件就不是很重要，这个后缀可以改为任意一种后缀，也可以无后缀。unix或linux中，文件名称由根目录名和子目录名构成，树型结构命名。

  2.结构。字节结构，记录结构和树结构.字节结构最常用，现在windows和unix是这样的。记录结构比如以前的打孔机。

  3.类型。普通文件和目录。普通文件包括二进制文件和ACSII文件。

  4.存取。顺序存取，随机存取。

  5.属性。

  ![](https://github.com/joy20182018/StudyBlog/blob/master/imag/2019-04-15%20200949.jpg)

  6.操作。

> create 创建空文件

> delete 删除文件释放磁盘空间

> open 打开文件

> close 关闭文件，释放内部空间，因为有些系统限制进程打开文件的数量。

> seek 在查找到的位置插入数据

  **目录**

  用于管理各种文件的一种文件

```
1. 一级目录系统。只有根目录和其子目录
```

  2.层次目录系统。树状图结构。

  3.路径名。

```
windows \usr\ast\mailbox
unix /usr/ast/mailbox
multics >ussr>ast>mailbox

如果路径名第一个是分隔符，则这个路径就是绝对路径。
```

  4.操作。

> create. 创建目录。

> delete. 删除目录。

> link. 连接多个文件，允许多个目录中只出现同一个文件名。这种连接增加了文件i节点的计数器的计数（记录含有该文件的目录项数目）

## 文件系统



  一般的文件系统在磁盘中的布局：

  MBR（主引导记录） + 分区表 + 磁盘分区

MBR用于BIOS运行时读取，对操作系统的引导。每个磁盘分区可能有一下参数：引导块，超级块，空闲空间管理，i节点，根目录，文件和目录。

​      其中非常重要的概念为i节点。i节点记录了文件的属性以及文件包含哪些磁盘块，这个表记录在内存中，表中只记录各个磁盘块的首地址，使得文件运行时查找磁盘块的速度非常快。

目录实现的方法：

​        目录的主要功能是把文件名设置为可以定位的坐标。如Windows和unix系统，目录的构成均为文件名+i节点。文件的相关属性存储在了i节点中。

日志文件系统：

​       windows中的NTFS和linux的ext3就是日志文件系统。将整个磁盘看作一个日志，记录系统下一步要做什么。则在系统崩溃时用处很大。日志中记录着系统对这个文件的所有操作，当系统崩溃时，重启系统后，系统可以按照日志的记录重新对文件操作，弥补之前的未完的操作。一个操作系统中总是会运行着许多的不同的文件系统，使用VFS（虚拟操作系统）进行管理。

虚拟文件系统（VFS）：

​        在windows中，可以看到不同的盘符可以设置为不同的文件系统。当一个进程打开一个文件时，盘符是隐含在其中的，所以windows系统知道该向哪个文件系统进行系统调用，无需进一步整合。

​        unix系统采用了VFS，把底层的不同的文件系统进行封装，各个文件系统只留出调用接口。VFS的下层就是连接这些接口。上层留出与进程相关的更高层的接口，采用标准的POSIX接口。VFS可以当一个操作系统去理解。把下面形状各异的，丑陋的文件系统封装起来，留出统一的美丽的接口，用于用户进程。当系统加载一个文件系统时，该文件系统需要在VFS中进行注册。注册时需要该文件系统提供一个可调用的函数或矢量表。此时，VFS只需要调用某个功能即可。

​        进程进行文件调用时，将文件描述符交给VFS，这些信息被保存在一个v节点（RAM）中。这些信息最重要的是包含v节点的功能指针，如read, write等。然后通过这些操作进入文件系统中。



## 总结

​       从系统的用户看，文件系统是一组文件和目录，以及对文件和目录的操作的集合。文件读写，目录创建删除。目录有根目录和子目录，子目录无穷无尽。

​       从设计者看，文件系统必须考虑存储区是如何分配的，系统如何记录哪个块分给哪个文件。可能的方案有，连续文件，链表，文件分配表和i节点。不同的文件系统目录也不同。文件的属性可以存放在目录中或i节点中。
